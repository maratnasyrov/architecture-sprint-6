# Средства отказоустойчивости

## 1. Ограничение скорости запросов (Rate Limiting)

Применение: На уровне сервиса ins-osago-aggregator.

Цель:

- Предотвращение перегрузки внешних API страховых компаний и обеспечение стабильной работы системы.

Механизм:

- Контроль количества запросов: Сервис ins-osago-aggregator отслеживает и ограничивает число исходящих запросов к REST API страховых компаний в единицу времени.
- Настраиваемые лимиты: Параметры ограничений могут быть индивидуальными для каждой страховой компании, учитывая их пропускную способность и соглашения об уровне обслуживания (SLA).

Преимущества:

- Предотвращение блокировок: Исключает возможность отказа сервисов страховых компаний из-за слишком высокой нагрузки.
- Улучшение пользовательского опыта: Снижает вероятность задержек и ошибок при обработке запросов пользователей.

## 2. Прерыватель цепи (Circuit Breaker)

Применение: Реализован на уровне ins-osago-aggregator при взаимодействии со страховыми компаниями.

Цель:

- Обеспечение устойчивости системы при сбоях или недоступности внешних сервисов страховых компаний.

Механизм:

- Мониторинг ошибок: Сервис отслеживает количество неудачных попыток взаимодействия с каждым API страховой компании.
- Открытие прерывателя: При превышении заданного порога ошибок circuit breaker переключается в открытое состояние, временно прекращая попытки отправки запросов к проблемному API.
- Полуоткрытое состояние: После заданного интервала времени circuit breaker переходит в полуоткрытое состояние, позволяя ограниченное число тестовых запросов для проверки доступности сервиса.
- Закрытие прерывателя: При успешных ответах от API circuit breaker возвращается в закрытое состояние, возобновляя нормальную работу.

Преимущества:

- Предотвращение перегрузки: Исключает бессмысленную нагрузку на недоступные сервисы, сохраняя ресурсы системы.
- Сокращение времени отклика: Улучшает время реакции системы, быстро уведомляя о недоступности сервиса без длительного ожидания.

## 3. Повтор запросов (Retry)

Применение: Автоматический повтор запросов при временных сбоях или недоступности API страховых компаний.

Цель:

- Повышение надежности взаимодействия с внешними сервисами при временных сетевых сбоях или кратковременной недоступности.

Механизм:

- Обработка ошибок: При получении определенных типов ошибок (например, тайм-ауты, сетевые сбои), сервис инициирует повторную отправку запроса.
- Стратегия повторов: Используется экспоненциальная задержка между попытками с добавлением случайного джиттера для распределения нагрузки и предотвращения пикирования запросов.
- Ограничение количества попыток: Устанавливается максимальное число повторных попыток, чтобы избежать бесконечных циклов.

Преимущества:

- Устранение временных сбоев: Позволяет успешно выполнить запросы при кратковременных проблемах с сетью или сервисом.
- Повышение надежности: Увеличивает вероятность успешного взаимодействия без вмешательства пользователя.

## 4. Таймауты (Timeout)

Применение: Установка ограничений на время ожидания ответа от API страховых компаний.

Цель:

- Предотвращение длительного ожидания ответа от внешних сервисов, которые могут быть недоступны или работать нестабильно.

Механизм:

- Таймауты подключения: Устанавливают максимальное время на установление соединения с API страховой компании.
- Таймауты чтения: Определяют максимальное время ожидания получения полного ответа после успешного подключения.
- Конфигурация: Таймауты настроены на значение 60 секунд, что является разумным балансом между ожиданием ответа и своевременным обнаружением проблемы.

Преимущества:

- Улучшение отклика системы: Позволяет быстро реагировать на недоступность внешних сервисов, не блокируя потоки обработки.
- Ресурсная эффективность: Освобождает ресурсы системы для обработки других запросов при возникновении задержек.
